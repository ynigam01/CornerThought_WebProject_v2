<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CornerThought - User Portal</title>

    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <!-- Header -->
    <header class="toolbar">
        <a href="#home" class="company-name" id="homeLink">CornerThought</a>
        <div class="user-info">
            <button class="add-data-button">Add Data</button>
            <button class="logout-button">Logout</button>
        </div>
    </header>

    <!-- Layout -->
    <div class="admin-dashboard-layout">
        <aside class="sidebar">
            <nav class="main-nav">
                <a href="#" class="nav-item active">
                    <i class="fas fa-folder"></i> My Projects
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-search"></i> Search Projects
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-globe"></i> General Search
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-cog"></i> Organization Settings
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <section id="homeView" class="view">
                <h1>Welcome, User</h1>

                <!-- Display area for Issue/Success entries -->
                <div id="issueSuccessDisplay" class="display-area" style="display: none;"></div>

                <!-- Forms will be injected here dynamically -->
                <div id="projectFormContainer"></div>
            </section>

            <section id="searchView" class="view" hidden></section>

            <section id="projectsView" class="view" hidden>
                <h1>My Projects</h1>
                <div class="projects-search">
                    <label for="projectSearch">Select or search a project</label>
                    <input id="projectSearch" class="search-input" list="projectsList" placeholder="Start typing to search...">
                    <datalist id="projectsList">
                        <option value="Project Apollo">
                        <option value="Project Borealis">
                        <option value="Project Catalyst">
                        <option value="Project Delta">
                        <option value="Project Endeavor">
                    </datalist>
                </div>
            </section>

            <section id="createView" class="view" hidden>
                <h2>Create New Project</h2>
                <p>Use the form to create a new project.</p>
            </section>

            <section id="addDataView" class="view" hidden>
                <div class="add-data-header">
                    <h2>Add Data <span id="addDataProjectName" class="add-data-project-name"></span></h2>
                    <div class="add-data-header-actions">
                        <button id="saveLessonsButton" class="save-lessons-button" type="button">Save</button>
                        <button id="addMetadataButton" class="add-metadata-button" type="button">Add Metadata</button>
                    </div>
                </div>
                <div id="addDataDisplay" class="display-area" style="display: none;"></div>
            </section>

            <template id="orgSettingsTemplate">
                <section id="orgView" class="view">
                    <!-- Default Organization Settings summary -->
                    <div id="orgMainSummary">
                        <h2>Number of Users: <span id="userCount">0</span></h2>
                        <h3>Manage Users</h3>
                        <div class="org-users-actions">
                            <button id="addNewUserButton">Add New User</button>
                            <button id="manageUsersButton">Manage Users</button>
                        </div>
                        <h3>Manage Projects</h3>
                        <div class="org-projects-actions">
                            <button id="manageProjectsButton">Manage Projects</button>
                            <button class="create-project-button">Create New Project</button>
                        </div>
                        <h3>Manage Teams</h3>
                        <div class="org-teams-actions">
                            <button id="manageOrgTeamsButton">Manage Organizational Teams</button>
                        </div>
                        <h3>Manage Assets</h3>
                        <div class="org-assets-actions">
                            <button id="createNewAssetButton">Create New Asset</button>
                        </div>
                    </div>

                    <!-- Manage Users module (shown when user clicks Manage Users) -->
                    <div id="orgManageUsersPanel" class="project-types-panel" style="display: none;">
                        <div class="project-types-panel-header">
                            <div>
                                <h3>Manage Users</h3>
                                <p class="subtitle">Select a user in your organization to edit profile details.</p>
                            </div>
                            <div class="project-types-panel-header-actions">
                                <button type="button" id="orgManageUsersRefreshButton" class="secondary-button">Refresh List</button>
                                <button type="button" id="orgManageUsersBackButton" class="secondary-button">Go Back</button>
                            </div>
                        </div>
                        <div id="orgManageUsersStatus" class="upload-message" style="display: none;"></div>
                        <div id="orgManageUsersTableWrap" style="margin-top: 12px;"></div>
                    </div>

                    <!-- Manage Organizational Teams module (shown when user clicks Manage Organizational Teams) -->
                    <div id="orgTeamsPanel" class="project-types-panel" style="display: none;">
                        <div class="project-types-panel-header">
                            <div>
                                <h3>Manage Organizational Teams</h3>
                                <p class="subtitle">Search and select a user in your organization.</p>
                            </div>
                            <button type="button" id="orgTeamsBackButton" class="secondary-button">Go Back</button>
                        </div>

                        <h3 style="margin: 14px 0 10px;">Upload Organizational Teams</h3>
                        <div class="form-group">
                            <label for="orgTeamsUploadFile">Upload Excel File</label>
                            <input type="file" id="orgTeamsUploadFile" accept=".xlsx,.xls,.csv">
                        </div>
                        <div class="form-buttons" style="margin-bottom: 12px;">
                            <button type="button" id="orgTeamsUploadButton" class="secondary-button">Upload File</button>
                        </div>
                        <div id="orgTeamsUploadStatus" class="upload-message" style="display: none;"></div>

                        <div class="form-group">
                            <label for="orgTeamsUserSelect">User</label>
                            <select id="orgTeamsUserSelect">
                                <option value="">Select User</option>
                            </select>
                        </div>
                        <div id="orgTeamsUserStatus" class="upload-message" style="display: none;"></div>

                        <div class="form-buttons" style="margin-top: 10px;">
                            <button type="button" id="orgTeamsAssignButton" class="secondary-button">Assign Teams</button>
                        </div>

                        <div id="orgTeamsAssignSubmodule" class="project-types-panel" style="display: none; margin-top: 14px;">
                            <div class="project-types-panel-header">
                                <div>
                                    <h3>Assign Teams</h3>
                                    <p class="subtitle">Click departments to select/unselect, then save.</p>
                                </div>
                                <button type="button" id="orgTeamsAssignBackButton" class="secondary-button">Back</button>
                            </div>
                            <div class="form-buttons">
                                <button type="button" id="orgTeamsAssignRefreshButton" class="secondary-button">Refresh List</button>
                                <button type="button" id="orgTeamsAssignSaveButton" class="secondary-button">Save Assignments</button>
                            </div>
                            <div id="orgTeamsAssignStatus" class="upload-message" style="display: none;"></div>
                            <div id="orgTeamsAssignTableWrap" style="margin-top: 12px;"></div>
                        </div>
                    </div>

                    <!-- Manage Projects & Project Types module (shown when user clicks Manage Projects) -->
                    <div id="orgProjectsPanel" class="project-types-panel" style="display: none;">
                        <div class="project-types-panel-header">
                            <div>
                                <h3>Manage Projects &amp; Project Types</h3>
                                <p class="subtitle" id="orgProjectsSubtitle">Create new project types that are specific to your organization.</p>
                            </div>
                            <button type="button" id="orgProjectsBackButton" class="secondary-button">Go Back</button>
                        </div>
                        <form id="orgProjectTypesForm">
                            <div class="form-group">
                                <label for="orgProjectTypeName">Project Type</label>
                                <input type="text" id="orgProjectTypeName" required>
                            </div>
                            <div class="form-buttons">
                                <button type="submit" class="public-projects-button">Save Project Type</button>
                                <!-- New Manage Projects button inside the Manage Projects sub-module -->
                                <button type="button" id="orgManageProjectsButton" class="secondary-button">
                                    Manage Projects
                                </button>
                            </div>
                        </form>

                        <!-- Manage Projects sub-module: Projects and Project Details dropdowns -->
                        <div id="orgManageProjectsSubmodule" style="display: none; margin-top: 10px;">
                            <div class="form-group">
                                <label for="orgProjectsSelect">Projects</label>
                                <select id="orgProjectsSelect">
                                    <option value="">Select Project</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="orgProjectDetailsSelect">Project Details</label>
                                <select id="orgProjectDetailsSelect" disabled>
                                    <option value="">Select a project to see its details</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Create New Asset module (shown when user clicks Create New Asset) -->
                    <div id="orgAssetsPanel" class="project-types-panel" style="display: none;">
                        <div id="orgAssetsCreateHeader" class="project-types-panel-header">
                            <div>
                                <h3>Create New Asset</h3>
                                <p class="subtitle">Create an asset for your organization.</p>
                            </div>
                            <button type="button" id="orgAssetsBackButton" class="secondary-button">Go Back</button>
                        </div>

                        <form id="orgAssetsForm">
                            <div class="form-group">
                                <label for="assetName">Asset Name</label>
                                <input type="text" id="assetName" required>
                            </div>
                            <div class="form-group">
                                <label for="assetDescription">Asset Description</label>
                                <textarea id="assetDescription" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="assetBuildStartDate">Build Start Date</label>
                                <input type="date" id="assetBuildStartDate">
                            </div>
                            <div class="form-group">
                                <label for="assetCompletionDate">Completion Date</label>
                                <input type="date" id="assetCompletionDate">
                            </div>
                            <div class="form-buttons">
                                <button type="submit" class="public-projects-button">Create Asset</button>
                                <button type="button" id="assetDetailsButton" class="secondary-button">Asset Details</button>
                            </div>
                            <div id="orgAssetsStatus" class="upload-message" style="display: none;"></div>
                        </form>

                        <div id="orgAssetDetailsPanel" style="display: none; margin-top: 14px;">
                            <div class="project-types-panel-header">
                                <div>
                                    <h3>Asset Details</h3>
                                </div>
                                <div class="project-types-panel-header-actions">
                                    <button type="button" id="orgAssetDetailsBackButton" class="secondary-button">Back to Create Asset</button>
                                    <button type="button" id="orgAssetDetailsOrgBackButton" class="secondary-button">Go Back</button>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="orgAssetDetailsAssetSelect">Asset</label>
                                <select id="orgAssetDetailsAssetSelect">
                                    <option value="">Select Asset</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="orgAssetDetailsProjectSelect">Project</label>
                                <select id="orgAssetDetailsProjectSelect">
                                    <option value="">Select Project</option>
                                    <option value="na">N/A</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="orgAssetDetailsFileTypeSelect">Select Input Data File Type</label>
                                <select id="orgAssetDetailsFileTypeSelect">
                                    <option value="">Select File Type</option>
                                    <option value="excel_general">Excel - General</option>
                                </select>
                            </div>

                            <div id="orgAssetDetailsUploadWrap" style="display: none;">
                                <div class="form-group">
                                    <label for="orgAssetDetailsFileInput">Upload Spreadsheet</label>
                                    <input type="file" id="orgAssetDetailsFileInput" accept=".xlsx,.xls">
                                </div>
                                <div class="form-buttons">
                                    <button type="button" id="orgAssetDetailsUploadButton" class="secondary-button">Upload Spreadsheet</button>
                                </div>
                                <div id="orgAssetDetailsStatus" class="upload-message" style="display: none;"></div>
                            </div>
                        </div>
                    </div>
                </section>
            </template>
        </main>
    </div>

    <!-- Edit Modal -->
    <div class="edit-modal" id="editModal">
        <div class="edit-modal-content">
            <button class="close-edit-button" id="closeEditModal">&times;</button>
            <h3 id="editModalTitle">Edit Text</h3>
            <textarea id="editTextarea" placeholder="Enter text here..."></textarea>
            <div class="edit-modal-buttons">
                <button class="cancel-edit-button" id="cancelEdit">Cancel</button>
                <button class="save-edit-button" id="saveEdit">Change</button>
            </div>
        </div>
    </div>

    <!-- Edit Organization User Modal -->
    <div class="modal modal--center" id="editOrgUserModal">
        <div class="modal-content" style="max-width: 520px;">
            <button class="close-button" id="closeEditOrgUserModal">&times;</button>
            <h3>Edit User</h3>
            <form id="editOrgUserForm">
                <div class="input-group">
                    <label for="editOrgUserName">Name</label>
                    <input type="text" id="editOrgUserName" required>
                </div>
                <div class="input-group">
                    <label for="editOrgUserEmail">Email</label>
                    <input type="email" id="editOrgUserEmail" required>
                </div>
                <div class="input-group">
                    <label for="editOrgUserType">User Type</label>
                    <select id="editOrgUserType" required>
                        <option value="">Select a user type</option>
                        <option value="Administrator">Administrator</option>
                        <option value="Leadership">Leadership</option>
                        <option value="Project Manager">Project Manager</option>
                        <option value="Subject Matter Expert">Subject Matter Expert</option>
                        <option value="Team Member">Team Member</option>
                    </select>
                </div>
                <div id="editOrgUserStatus" class="upload-message" style="display: none;"></div>
                <div class="modal-actions">
                    <button type="button" id="cancelEditOrgUserButton">Cancel</button>
                    <button type="submit" id="saveEditOrgUserButton">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- JS (always placed at end for performance) -->
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
    <script type="module" src="js/user-portal.js"></script>
</body>
</html>
